--checking for any duplicates
--check for null
select cst_id, count(*) from (
select
cst_id,
cst_key,
cst_first_name,
 cst_lastname,
 cst_marital_status,
    cst_gndr,
    cst_create_date,
    ca.bdate,
    ca.gen,
    la.cntry
    from silver.crm_cust_info ci
    left join silver.erp_cust_az12 ca
    on ci.cst_key=ca.cid
    left join silver.erp_loc_a101 la
    on ci.cst_key=la.cid)t group by cst_id, 
    having count > 1


    ---when same columns exists twice
    select
    cst_gndr,
    ca.gen
    case when ci.cst_gndr!='n/a' then ci.cst_gnder
    else coalesce(ca.gen,'n/a')
    end as new_gen
    from silver.crm_cust_info ci
    left join silver.erp_cust_az12 ca
    on ci.cst_key=ca.cid
    left join silver.erp_loc_a101 la
    on ci.cst_key=la.cid



    --for products checking any duplciates
    select prd_key,count(*) from
    (
        select
        pn.prd_id,
        pn.cat_id,
        pn.prd_key,
        pn.prd_nm,
        pn.prd_line,
        pn.prd_start_dt,
        pr.prd_end_dt,
        pc.cat,
        pc.subcat,
        pc.maintenance
        from silver.crm_prd_info pn
         left join silver.erp_px_cat_g1v2 pc
         --trying to remove historical data if end date is null then it is current data
         where prd_end_dt is null) t 
         group by prd_key
         having count(*) > 1



         --foreign key integrity//quality check for the gold gact table
         select * from gold.fat_sales f
         left join gold.dim_customers c
         on customer_key=f.customer_key
         left join gold.dim_products p
         on pr.product_key=f.products_key
         where p.product_key=f.product_key
        -- where c.customer_key is null//checking with customer

